# Analysis Pipeline for Nature News Articles

Note: This is currently a work in progress -- many things will change and may also be undocumented at this moment.

The code is made of 2 parts currently: 
1. Scrape Nature News Articles
2. Analyze the text of the articles to identify possible speaker biases

To download neccessary software and reference data, you must run [setup.sh](https://github.com/nrosed/nature_news_disparities/blob/main/nature_news_scraper/setup.sh)

Quick data folder overview:
-  `./data/reference_data/*`
     - has all annotation data for country mapping
- `./ benchmark_data/*`
     - this contains the generated benchmark scraped output (`*_raw.tsv`) and the hand annotated benchmark `*_hand_annotated.tsv`
     - all links considered for scraping can be found here in `links.json`
     - all text scraped is in `links_crawled.json`

Quick code overview:
- `./utils/*` 
     - has all R helper functions for processing scraped text and plotting
- `./nature_news_scraper/*`
     - This contains all scraping code. Most is auto-generated by scrapy
- ` ./process_scraped_data/*`
     - this contains the scripts to pre-process the output from coreNLP into a format that will be used for comparison. 
     - to make the benchmark quote and location data, you run `run_process_benchmark_scrape.sh` which runs the other scripts in the folder in the following order
     1. `process_benchmark_scrape.R` processes the scrapy output before running coreNLP.
     2. coreNLP is run on the output
     3. files with `*location*` process coreNLP output for country comparisons
     4. files with `*quote*` process coreNLP output for quoted gender comparisons
- `./analyze_benchmark_data/*`
     - this contains all analysis scripts. To view the analysis on github you can view it in `benchmark_analysis.md`



## Scraping
  
The code relies upon [scrapy](https://docs.scrapy.org/en/latest/index.html) to crawl links and process the articles.
This code is found in [here](https://github.com/nrosed/nature_news_disparities/tree/main/nature_news_scraper), and most of which is automatically generated.
To run the scraper tool, you run the shell script found here: [run_scrape_gold_standard.sh](https://github.com/nrosed/nature_news_disparities/blob/main/nature_news_scraper/run_scrape_gold_standard.sh).
This runs an initial scrape to identify all articles in 2020, 2015, and 2010, then randomly chooses 10 from each year to write to a file. 
This will later be extended.
  
## Analysis
  
Currently, we look at the proportion of MALE:FEMALE quoted speakers in each article and which countries are mentioned in each article.
All analysis functions and markdown code that utilizes the functions can be found in [here](https://github.com/nrosed/nature_news_disparities/tree/main/analyze_benchmark_data/).

To view the current state of the analysis on github, click [here](https://github.com/nrosed/nature_news_disparities/tree/main/analyze_benchmark_data/benchmark_analysis.md).

